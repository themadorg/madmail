<!DOCTYPE html>
<html lang="fa" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ø¨Ø§ Ø¯Ø§Ú©Ø± - {{.WebDomain | cleanDomain}}</title>
    <link rel="stylesheet" href="/main.css">
    <style>
        .doc-container {
            max-width: 800px;
            margin: 40px auto;
            padding: 20px;
            background: var(--card-bg);
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            direction: rtl;
        }

        h2 {
            margin-top: 30px;
            border-bottom: 2px solid var(--accent-color);
            padding-bottom: 10px;
            display: inline-block;
        }

        h3 {
            margin-top: 25px;
            color: var(--accent-color);
        }

        .highlight {
            color: var(--accent-color);
            font-weight: bold;
        }

        .code-box {
            direction: ltr;
            background: rgba(255, 255, 255, 0.05);
            padding: 12px 16px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            text-align: left;
            margin: 10px 0;
            word-break: break-all;
            white-space: pre-wrap;
            border: 1px dashed #444;
            color: #ddd;
            line-height: 1.6;
        }

        .tip-box {
            background: rgba(0, 210, 255, 0.1);
            border-right: 4px solid #00d2ff;
            padding: 15px;
            margin: 20px 0;
            border-radius: 4px;
        }

        .warn-box {
            background: rgba(255, 180, 0, 0.1);
            border-right: 4px solid #ffb400;
            padding: 15px;
            margin: 20px 0;
            border-radius: 4px;
        }

        .port-table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
            direction: ltr;
            text-align: left;
        }

        .port-table th,
        .port-table td {
            border: 1px solid rgba(255, 255, 255, 0.15);
            padding: 8px 12px;
        }

        .port-table th {
            background: rgba(255, 255, 255, 0.08);
            color: var(--accent-color);
        }

        .port-table td {
            color: #ccc;
        }

        .code-container {
            margin: 20px 0;
            text-align: left;
            direction: ltr;
        }

        .code-header {
            background: rgba(255, 255, 255, 0.1);
            color: var(--accent-color);
            padding: 5px 15px;
            font-size: 0.8em;
            font-family: monospace;
            border-top-left-radius: 6px;
            border-top-right-radius: 6px;
            border: 1px dashed #444;
            border-bottom: none;
            display: inline-block;
        }

        .code-box {
            margin-top: 0 !important;
            border-top-left-radius: 0 !important;
            max-height: 400px;
            overflow-y: auto;
            border: 1px dashed #444 !important;
        }

        .one-liner {
            direction: ltr;
            background: #101010;
            border: 1px solid var(--accent-color);
            color: #00d2ff;
            padding: 15px;
            border-radius: 6px;
            font-family: monospace;
            margin: 40px 0 20px;
            position: relative;
            text-align: left;
            word-break: break-all;
            white-space: pre-wrap;
            font-size: 0.85em;
        }

        .one-liner::after {
            content: "Ø¯Ø³ØªÙˆØ± ØªÚ©â€ŒØ®Ø·ÛŒ (Docker Run)";
            position: absolute;
            top: -12px;
            left: 15px;
            background: var(--accent-color);
            color: #000;
            font-size: 0.7em;
            padding: 2px 8px;
            border-radius: 4px;
            font-weight: bold;
        }
    </style>
</head>

<body>
    <ul id="menu">
        <li><a href="/">Ø§ØµÙ„ÛŒ</a></li>
        <li><a href="/docs">Ù…Ø³ØªÙ†Ø¯Ø§Øª</a></li>
    </ul>

    <div class="doc-container">
        <h1>ğŸ³ Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ø¨Ø§ Ø¯Ø§Ú©Ø±</h1>
        <p>Ø§Ú¯Ø± ØªØ±Ø¬ÛŒØ­ Ù…ÛŒâ€ŒØ¯Ù‡ÛŒØ¯ Ø³Ø±ÙˆØ± <span class="highlight">Madmail</span> Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ø§ Ø¯Ø§Ú©Ø± Ø§Ø¬Ø±Ø§ Ú©Ù†ÛŒØ¯ØŒ
            ØªØµØ§ÙˆÛŒØ± Ø±Ø³Ù…ÛŒ Ø§Ø² Ø·Ø±ÛŒÙ‚ <span class="highlight">GitHub Container Registry (GHCR)</span> Ø¯Ø± Ø¯Ø³ØªØ±Ø³ Ù‡Ø³ØªÙ†Ø¯.</p>

        <h2>Ø´Ø±ÙˆØ¹ Ø³Ø±ÛŒØ¹</h2>
        <div class="code-box">docker pull ghcr.io/themadorg/madmail:latest</div>

        <h3>ØªÚ¯â€ŒÙ‡Ø§ÛŒ ØªØµÙˆÛŒØ±</h3>
        <table class="port-table">
            <tr>
                <th>Tag</th>
                <th>ØªÙˆØ¶ÛŒØ­Ø§Øª</th>
            </tr>
            <tr>
                <td><code>latest</code></td>
                <td>Ø¢Ø®Ø±ÛŒÙ† Ù†Ø³Ø®Ù‡ Ù¾Ø§ÛŒØ¯Ø§Ø± Ø§Ø² Ø´Ø§Ø®Ù‡ main</td>
            </tr>
            <tr>
                <td><code>X.Y.Z</code></td>
                <td>Ù†Ø³Ø®Ù‡ Ù…Ø´Ø®Øµ (Ù…Ø«Ù„Ø§Ù‹ 0.18.0)</td>
            </tr>
        </table>

        <h2>Ø±ÙˆØ´ Û±: Ø³Ø§Ø¯Ù‡ Ø¨Ø§ Ø¢ÛŒâ€ŒÙ¾ÛŒ (SQLite)</h2>
        <p>Ù…Ù†Ø§Ø³Ø¨ Ø¨Ø±Ø§ÛŒ: ØªØ³Øª Ø³Ø±ÛŒØ¹ØŒ Ø³Ø±ÙˆØ±Ù‡Ø§ÛŒ ØªÚ©â€ŒÙ†ÙØ±Ù‡ØŒ ØªØ±Ø§ÙÛŒÚ© Ú©Ù…</p>

        <div class="one-liner">docker run -d --name madmail \
            -p 25:25 -p 143:143 -p 465:465 -p 587:587 -p 993:993 -p 80:80 -p 443:443 -p 1080:1080 \
            -v ./maddy.conf:/data/maddy.conf -v ./data:/data -v ./tls:/data/tls \
            -e MADDY_HOSTNAME=SERVER_IP -e MADDY_DOMAIN="[SERVER_IP]" -e MADDY_PUBLIC_IP=SERVER_IP \
            ghcr.io/themadorg/madmail:latest</div>

        <p>ÛŒÚ© ÙØ§ÛŒÙ„ <code>docker-compose.yml</code> Ùˆ ÛŒÚ© ÙØ§ÛŒÙ„ <code>maddy.conf</code> Ù†ÛŒØ§Ø² Ø¯Ø§Ø±ÛŒØ¯.
            Ø¯Ø± Ø§ÛŒÙ† Ø­Ø§Ù„Øª Ú¯ÙˆØ§Ù‡ÛŒÙ†Ø§Ù…Ù‡ TLS Ø®ÙˆØ¯Ø§Ù…Ø¶Ø§ (self-signed) Ø¨Ù‡ ØµÙˆØ±Øª Ø®ÙˆØ¯Ú©Ø§Ø± ØªÙˆÙ„ÛŒØ¯ Ù…ÛŒâ€ŒØ´ÙˆØ¯.</p>

        <div class="code-container">
            <div class="code-header">docker-compose.yml</div>
            <pre class="code-box">services:
  madmail:
    image: ghcr.io/themadorg/madmail:latest
    restart: always
    ports:
      - "25:25"      # SMTP
      - "143:143"    # IMAP
      - "465:465"    # Submission TLS
      - "587:587"    # Submission STARTTLS
      - "993:993"    # IMAPS
      - "80:80"      # HTTP
      - "443:443"    # HTTPS
      - "1080:1080"  # Shadowsocks
    volumes:
      - ./maddy.conf:/data/maddy.conf
      - ./data:/data
      - ./tls:/data/tls
    environment:
      - MADDY_HOSTNAME=SERVER_IP
      - MADDY_DOMAIN=[SERVER_IP]
      - MADDY_PUBLIC_IP=SERVER_IP</pre>
        </div>

        <div class="code-container">
            <div class="code-header">maddy.conf</div>
            <pre class="code-box">$(hostname) = {env:MADDY_HOSTNAME}
$(primary_domain) = {env:MADDY_DOMAIN}
$(local_domains) = $(primary_domain) $(hostname)
$(public_ip) = {env:MADDY_PUBLIC_IP}

tls file /data/tls/fullchain.pem /data/tls/privkey.pem

state_dir /data

auth.pass_table local_authdb {
    auto_create yes
    table sql_table {
        driver sqlite3
        dsn /data/credentials.db
        table_name passwords
    }
}

storage.imapsql local_mailboxes {
    auto_create yes
    driver sqlite3
    dsn /data/imapsql.db
}

hostname $(hostname)

table.chain local_rewrites {
    optional_step regexp "(.+)\+(.+)@(.+)" "$1@$3"
    optional_step static {
        entry postmaster postmaster@$(primary_domain)
    }
}

msgpipeline local_routing {
    destination postmaster $(local_domains) {
        modify {
            replace_rcpt &local_rewrites
        }
        deliver_to &local_mailboxes
    }
    default_destination {
        reject 550 5.1.1 "User doesn't exist"
    }
}

smtp tcp://0.0.0.0:25 {
    dmarc yes
    check {
        require_mx_record
        dkim
        spf
    }
    source $(local_domains) {
        reject 501 5.1.8 "Use Submission for outgoing SMTP"
    }
    default_source {
        destination postmaster $(local_domains) {
            deliver_to &local_routing
        }
        default_destination {
            reject 550 5.1.1 "User doesn't exist"
        }
    }
}

submission tls://0.0.0.0:465 tcp://0.0.0.0:587 {
    auth &local_authdb
    tls file /data/tls/fullchain.pem /data/tls/privkey.pem
    source $(local_domains) {
        check {
            authorize_sender {
                prepare_email &local_rewrites
                user_to_email identity
            }
        }
        destination postmaster $(local_domains) {
            deliver_to &local_routing
        }
        default_destination {
            modify {
                dkim $(primary_domain) $(local_domains) default
            }
            deliver_to &remote_queue
        }
    }
    default_source {
        reject 501 5.1.8 "Non-local sender domain"
    }
}

target.remote outbound_delivery {
    mx_auth {
        dane
        mtasts {
            cache fs
            fs_dir mtasts_cache/
        }
        local_policy {
            min_tls_level encrypted
            min_mx_level none
        }
    }
}

target.queue remote_queue {
    target &outbound_delivery
    autogenerated_msg_domain $(primary_domain)
    bounce {
        destination postmaster $(local_domains) {
            deliver_to &local_routing
        }
        default_destination {
            reject 550 5.0.0 "Refusing to send DSNs to non-local addresses"
        }
    }
}

imap tls://0.0.0.0:993 tcp://0.0.0.0:143 {
    auth &local_authdb
    storage &local_mailboxes
    tls file /data/tls/fullchain.pem /data/tls/privkey.pem
}

chatmail tls://0.0.0.0:443 tcp://0.0.0.0:80 {
    mail_domain $(primary_domain)
    mx_domain $(hostname)
    web_domain $(hostname)
    public_ip $(public_ip)
    auth_db local_authdb
    storage local_mailboxes
    tls file /data/tls/fullchain.pem /data/tls/privkey.pem
    ss_addr 0.0.0.0:1080
}</pre>
        </div>

        <div class="tip-box">
            <strong>Ù†Ú©ØªÙ‡:</strong> ÙˆÙ‚ØªÛŒ Ø§Ø² Ø¢ÛŒâ€ŒÙ¾ÛŒ Ø¨Ø¬Ø§ÛŒ Ø¯Ø§Ù…Ù†Ù‡ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒÚ©Ù†ÛŒØ¯ØŒ Ø¨Ø§ÛŒØ¯ Ø¢Ù† Ø±Ø§ Ø¯Ø±
            <code>MADDY_DOMAIN</code> Ø¯Ø§Ø®Ù„ Ø¨Ø±Ø§Ú©Øª Ù‚Ø±Ø§Ø± Ø¯Ù‡ÛŒØ¯: <code dir="ltr">[203.0.113.50]</code>
        </div>

        <h2>Ø±ÙˆØ´ Û²: Ø¨Ø§ PostgreSQL</h2>
        <p>Ù…Ù†Ø§Ø³Ø¨ Ø¨Ø±Ø§ÛŒ: Ù…Ø­ÛŒØ· ØªÙˆÙ„ÛŒØ¯ØŒ ØªØ±Ø§ÙÛŒÚ© Ø¨Ø§Ù„Ø§ØŒ Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ù‡Ù…Ø²Ù…Ø§Ù† Ø²ÛŒØ§Ø¯</p>
        <p>Ù…Ø´Ú©Ù„ <code>database is locked</code> Ø¯Ø± SQLite Ø¨Ø§ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² PostgreSQL Ø¨Ø±Ø·Ø±Ù Ù…ÛŒâ€ŒØ´ÙˆØ¯.
            Ù‡Ù…Ú†Ù†ÛŒÙ† pub/sub Ø¨Ø±Ø§ÛŒ Ø¢Ù¾Ø¯ÛŒØªâ€ŒÙ‡Ø§ÛŒ IMAP Ø¨Ù„Ø§Ø¯Ø±Ù†Ú¯ ÙØ¹Ø§Ù„ Ù…ÛŒâ€ŒØ´ÙˆØ¯.</p>

        <div class="one-liner">docker network create mad-net && \
            docker run -d --name db --network mad-net -e POSTGRES_PASSWORD=pass -e POSTGRES_DB=maddy postgres:16-alpine
            && \
            docker run -d --name madmail --network mad-net -p 25:25 -p 143:143 -p 465:465 -p 587:587 -p 993:993 -p 80:80
            -p 443:443 -p 1080:1080 \
            -v ./maddy.conf:/data/maddy.conf -v ./data:/data -v ./tls:/data/tls \
            -e MADDY_HOSTNAME=SERVER_IP -e MADDY_DOMAIN="[SERVER_IP]" -e MADDY_PUBLIC_IP=SERVER_IP \
            ghcr.io/themadorg/madmail:latest</div>

        <div class="code-container">
            <div class="code-header">docker-compose.yml</div>
            <pre class="code-box">services:
  madmail:
    image: ghcr.io/themadorg/madmail:latest
    restart: always
    ports:
      - "25:25"
      - "143:143"
      - "465:465"
      - "587:587"
      - "993:993"
      - "80:80"
      - "443:443"
      - "1080:1080"
    volumes:
      - ./maddy.conf:/data/maddy.conf
      - ./data:/data
      - ./tls:/data/tls
    environment:
      - MADDY_HOSTNAME=SERVER_IP
      - MADDY_DOMAIN=[SERVER_IP]
      - MADDY_PUBLIC_IP=SERVER_IP
      - POSTGRES_USER=maddy
      - POSTGRES_PASSWORD=your-strong-password
      - POSTGRES_DB=maddy
    depends_on:
      - db

  db:
    image: postgres:16-alpine
    restart: always
    environment:
      - POSTGRES_USER=maddy
      - POSTGRES_PASSWORD=your-strong-password
      - POSTGRES_DB=maddy
    volumes:
      - pgdata:/var/lib/postgresql/data

volumes:
  pgdata:</pre>
        </div>

        <div class="code-container">
            <div class="code-header">maddy.conf</div>
            <pre class="code-box">$(hostname) = {env:MADDY_HOSTNAME}
$(primary_domain) = {env:MADDY_DOMAIN}
$(local_domains) = $(primary_domain) $(hostname)
$(public_ip) = {env:MADDY_PUBLIC_IP}

tls file /data/tls/fullchain.pem /data/tls/privkey.pem

state_dir /data

auth.pass_table local_authdb {
    auto_create yes
    table sql_table {
        driver postgres
        dsn "host=db dbname={env:POSTGRES_DB} user={env:POSTGRES_USER} password={env:POSTGRES_PASSWORD} sslmode=disable"
        table_name passwords
    }
}

storage.imapsql local_mailboxes {
    auto_create yes
    driver postgres
    dsn "host=db dbname={env:POSTGRES_DB} user={env:POSTGRES_USER} password={env:POSTGRES_PASSWORD} sslmode=disable"
}

hostname $(hostname)

table.chain local_rewrites {
    optional_step regexp "(.+)\+(.+)@(.+)" "$1@$3"
    optional_step static {
        entry postmaster postmaster@$(primary_domain)
    }
}

msgpipeline local_routing {
    destination postmaster $(local_domains) {
        modify {
            replace_rcpt &local_rewrites
        }
        deliver_to &local_mailboxes
    }
    default_destination {
        reject 550 5.1.1 "User doesn't exist"
    }
}

smtp tcp://0.0.0.0:25 {
    dmarc yes
    check {
        require_mx_record
        dkim
        spf
    }
    source $(local_domains) {
        reject 501 5.1.8 "Use Submission for outgoing SMTP"
    }
    default_source {
        destination postmaster $(local_domains) {
            deliver_to &local_routing
        }
        default_destination {
            reject 550 5.1.1 "User doesn't exist"
        }
    }
}

submission tls://0.0.0.0:465 tcp://0.0.0.0:587 {
    auth &local_authdb
    tls file /data/tls/fullchain.pem /data/tls/privkey.pem
    source $(local_domains) {
        check {
            authorize_sender {
                prepare_email &local_rewrites
                user_to_email identity
            }
        }
        destination postmaster $(local_domains) {
            deliver_to &local_routing
        }
        default_destination {
            modify {
                dkim $(primary_domain) $(local_domains) default
            }
            deliver_to &remote_queue
        }
    }
    default_source {
        reject 501 5.1.8 "Non-local sender domain"
    }
}

target.remote outbound_delivery {
    mx_auth {
        dane
        mtasts {
            cache fs
            fs_dir mtasts_cache/
        }
        local_policy {
            min_tls_level encrypted
            min_mx_level none
        }
    }
}

target.queue remote_queue {
    target &outbound_delivery
    autogenerated_msg_domain $(primary_domain)
    bounce {
        destination postmaster $(local_domains) {
            deliver_to &local_routing
        }
        default_destination {
            reject 550 5.0.0 "Refusing to send DSNs to non-local addresses"
        }
    }
}

imap tls://0.0.0.0:993 tcp://0.0.0.0:143 {
    auth &local_authdb
    storage &local_mailboxes
    tls file /data/tls/fullchain.pem /data/tls/privkey.pem
}

chatmail tls://0.0.0.0:443 tcp://0.0.0.0:80 {
    mail_domain $(primary_domain)
    mx_domain $(hostname)
    web_domain $(hostname)
    public_ip $(public_ip)
    auth_db local_authdb
    storage local_mailboxes
    tls file /data/tls/fullchain.pem /data/tls/privkey.pem
    ss_addr 0.0.0.0:1080
}</pre>
        </div>

        <h2>Ø±ÙˆØ´ Û³: Ø¯Ø§Ù…Ù†Ù‡ Ø¨Ø§ TLS Ø®ÙˆØ¯Ú©Ø§Ø± (Let's Encrypt)</h2>
        <p>Ù…Ù†Ø§Ø³Ø¨ Ø¨Ø±Ø§ÛŒ: Ù…Ø­ÛŒØ· ØªÙˆÙ„ÛŒØ¯ Ø¨Ø§ Ø¯Ø§Ù…Ù†Ù‡ ÙˆØ§Ù‚Ø¹ÛŒØŒ Ù…Ø¯ÛŒØ±ÛŒØª Ø®ÙˆØ¯Ú©Ø§Ø± Ú¯ÙˆØ§Ù‡ÛŒÙ†Ø§Ù…Ù‡</p>

        <div class="one-liner">docker run -d --name madmail \
            -p 25:25 -p 143:143 -p 465:465 -p 587:587 -p 993:993 -p 80:80 -p 443:443 -p 1080:1080 \
            -v ./maddy.conf:/data/maddy.conf -v ./data:/data \
            -e MADDY_HOSTNAME=chat.example.org -e MADDY_DOMAIN=chat.example.org \
            -e MADDY_PUBLIC_IP=SERVER_IP -e MADDY_ACME_EMAIL=admin@example.org \
            ghcr.io/themadorg/madmail:latest</div>

        <div class="warn-box">
            <strong>âš ï¸ Ù¾ÛŒØ´â€ŒÙ†ÛŒØ§Ø²Ù‡Ø§:</strong>
            <ul style="margin: 10px 0;">
                <li>Ø¯Ø§Ù…Ù†Ù‡ ÙˆØ§Ù‚Ø¹ÛŒ Ø¨Ø§ Ø±Ú©ÙˆØ±Ø¯ DNS A Ø¨Ù‡ Ø³Ù…Øª Ø³Ø±ÙˆØ± Ø´Ù…Ø§</li>
                <li>Ù¾ÙˆØ±Øª <strong>80</strong> Ø¨Ø§Ø² Ùˆ Ø§Ø² Ø§ÛŒÙ†ØªØ±Ù†Øª Ù‚Ø§Ø¨Ù„ Ø¯Ø³ØªØ±Ø³ (Ø¨Ø±Ø§ÛŒ Ú†Ø§Ù„Ø´ ACME)</li>
                <li>Ù¾ÙˆØ±Øª <strong>443</strong> Ø¨Ø§Ø² (Ø¨Ø±Ø§ÛŒ HTTPS)</li>
            </ul>
        </div>

        <div class="code-container">
            <div class="code-header">docker-compose.yml</div>
            <pre class="code-box">services:
  madmail:
    image: ghcr.io/themadorg/madmail:latest
    restart: always
    ports:
      - "25:25"
      - "143:143"
      - "465:465"
      - "587:587"
      - "993:993"
      - "80:80"       # ACME HTTP-01 challenge
      - "443:443"     # HTTPS
      - "1080:1080"   # Shadowsocks
    volumes:
      - ./maddy.conf:/data/maddy.conf
      - ./data:/data
    environment:
      - MADDY_HOSTNAME=chat.example.org
      - MADDY_DOMAIN=chat.example.org
      - MADDY_PUBLIC_IP=SERVER_IP
      - MADDY_ACME_EMAIL=admin@example.org</pre>
        </div>

        <div class="code-container">
            <div class="code-header">maddy.conf</div>
            <pre class="code-box">$(hostname) = {env:MADDY_HOSTNAME}
$(primary_domain) = {env:MADDY_DOMAIN}
$(local_domains) = $(primary_domain)
$(public_ip) = {env:MADDY_PUBLIC_IP}

tls {
    loader autocert {
        hostname {env:MADDY_HOSTNAME}
        email {env:MADDY_ACME_EMAIL}
        cache_dir /data/autocert
        agreed
    }
}

state_dir /data

auth.pass_table local_authdb {
    auto_create yes
    table sql_table {
        driver sqlite3
        dsn /data/credentials.db
        table_name passwords
    }
}

storage.imapsql local_mailboxes {
    auto_create yes
    driver sqlite3
    dsn /data/imapsql.db
}

hostname $(hostname)

table.chain local_rewrites {
    optional_step regexp "(.+)\+(.+)@(.+)" "$1@$3"
    optional_step static {
        entry postmaster postmaster@$(primary_domain)
    }
}

msgpipeline local_routing {
    destination postmaster $(local_domains) {
        modify {
            replace_rcpt &local_rewrites
        }
        deliver_to &local_mailboxes
    }
    default_destination {
        reject 550 5.1.1 "User doesn't exist"
    }
}

smtp tcp://0.0.0.0:25 {
    dmarc yes
    check {
        require_mx_record
        dkim
        spf
    }
    source $(local_domains) {
        reject 501 5.1.8 "Use Submission for outgoing SMTP"
    }
    default_source {
        destination postmaster $(local_domains) {
            deliver_to &local_routing
        }
        default_destination {
            reject 550 5.1.1 "User doesn't exist"
        }
    }
}

submission tls://0.0.0.0:465 tcp://0.0.0.0:587 {
    auth &local_authdb
    source $(local_domains) {
        check {
            authorize_sender {
                prepare_email &local_rewrites
                user_to_email identity
            }
        }
        destination postmaster $(local_domains) {
            deliver_to &local_routing
        }
        default_destination {
            modify {
                dkim $(primary_domain) $(local_domains) default
            }
            deliver_to &remote_queue
        }
    }
    default_source {
        reject 501 5.1.8 "Non-local sender domain"
    }
}

target.remote outbound_delivery {
    mx_auth {
        dane
        mtasts {
            cache fs
            fs_dir mtasts_cache/
        }
        local_policy {
            min_tls_level encrypted
            min_mx_level none
        }
    }
}

target.queue remote_queue {
    target &outbound_delivery
    autogenerated_msg_domain $(primary_domain)
    bounce {
        destination postmaster $(local_domains) {
            deliver_to &local_routing
        }
        default_destination {
            reject 550 5.0.0 "Refusing to send DSNs to non-local addresses"
        }
    }
}

imap tls://0.0.0.0:993 tcp://0.0.0.0:143 {
    auth &local_authdb
    storage &local_mailboxes
}

chatmail tls://0.0.0.0:443 {
    mail_domain $(primary_domain)
    mx_domain $(hostname)
    web_domain $(hostname)
    public_ip $(public_ip)
    auth_db local_authdb
    storage local_mailboxes
    ss_addr 0.0.0.0:1080
}</pre>
        </div>

        <div class="tip-box">
            <strong>Ø·Ø±Ø² Ú©Ø§Ø±:</strong>
            <ol style="margin: 10px 0; padding-right: 20px;">
                <li>Madmail ÛŒÚ© Ø³Ø±ÙˆØ± HTTP Ø±ÙˆÛŒ Ù¾ÙˆØ±Øª Û¸Û° Ø¨Ø±Ø§ÛŒ Ú†Ø§Ù„Ø´ ACME Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ù…ÛŒâ€ŒÚ©Ù†Ø¯</li>
                <li>Let's Encrypt Ø¯Ø± Ø§ÙˆÙ„ÛŒÙ† Ø§ØªØµØ§Ù„ TLSØŒ Ú¯ÙˆØ§Ù‡ÛŒÙ†Ø§Ù…Ù‡ ØµØ§Ø¯Ø± Ù…ÛŒâ€ŒÚ©Ù†Ø¯</li>
                <li>Ú¯ÙˆØ§Ù‡ÛŒÙ†Ø§Ù…Ù‡â€ŒÙ‡Ø§ Ø¯Ø± <code>/data/autocert/</code> Ø°Ø®ÛŒØ±Ù‡ Ùˆ Ø®ÙˆØ¯Ú©Ø§Ø± ØªÙ…Ø¯ÛŒØ¯ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯</li>
                <li>Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§ÛŒ HTTP ØºÛŒØ± ACME Ø¨Ù‡ HTTPS Ø±ÛŒØ¯Ø§ÛŒØ±Ú©Øª Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯ (302)</li>
            </ol>
        </div>

        <div class="tip-box">
            <strong>Ø¬Ø§ÛŒÚ¯Ø²ÛŒÙ†:</strong> Ø§Ú¯Ø± Ú¯ÙˆØ§Ù‡ÛŒÙ†Ø§Ù…Ù‡ Ø®ÙˆØ¯ØªØ§Ù† Ø±Ø§ Ø¯Ø§Ø±ÛŒØ¯ (Ù…Ø«Ù„Ø§Ù‹ Ø§Ø² certbot):
            <div class="code-box" style="margin-top: 10px;">tls file /data/tls/fullchain.pem /data/tls/privkey.pem</div>
            <p style="margin-top: 5px;">Ùˆ Ø¯Ø± docker-compose ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ TLS Ø±Ø§ mount Ú©Ù†ÛŒØ¯: <code
                    dir="ltr">./tls:/data/tls</code></p>
        </div>

        <h2>Ù¾ÙˆØ±Øªâ€ŒÙ‡Ø§</h2>
        <table class="port-table">
            <tr>
                <th>Port</th>
                <th>Protocol</th>
                <th>ØªÙˆØ¶ÛŒØ­Ø§Øª</th>
            </tr>
            <tr>
                <td>25</td>
                <td>SMTP</td>
                <td>Ø§Ø±Ø³Ø§Ù„ Ùˆ Ø¯Ø±ÛŒØ§ÙØª Ø§ÛŒÙ…ÛŒÙ„</td>
            </tr>
            <tr>
                <td>143</td>
                <td>IMAP</td>
                <td>Ø®ÙˆØ§Ù†Ø¯Ù† Ø§ÛŒÙ…ÛŒÙ„ (STARTTLS)</td>
            </tr>
            <tr>
                <td>465</td>
                <td>Submission</td>
                <td>Ø§Ø±Ø³Ø§Ù„ Ø§ÛŒÙ…ÛŒÙ„ (TLS/SSL)</td>
            </tr>
            <tr>
                <td>587</td>
                <td>Submission</td>
                <td>Ø§Ø±Ø³Ø§Ù„ Ø§ÛŒÙ…ÛŒÙ„ (STARTTLS)</td>
            </tr>
            <tr>
                <td>993</td>
                <td>IMAPS</td>
                <td>Ø®ÙˆØ§Ù†Ø¯Ù† Ø§ÛŒÙ…ÛŒÙ„ (TLS/SSL)</td>
            </tr>
            <tr>
                <td>80</td>
                <td>HTTP</td>
                <td>Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… + Ú†Ø§Ù„Ø´ ACME</td>
            </tr>
            <tr>
                <td>443</td>
                <td>HTTPS</td>
                <td>Admin API Ùˆ Ø«Ø¨Øªâ€ŒÙ†Ø§Ù…</td>
            </tr>
            <tr>
                <td>1080</td>
                <td>TCP</td>
                <td>Ù¾Ø±ÙˆÚ©Ø³ÛŒ Shadowsocks</td>
            </tr>
        </table>

        <h2>Ø­Ø¬Ù…â€ŒÙ‡Ø§ (Volumes)</h2>
        <table class="port-table">
            <tr>
                <th>Path</th>
                <th>ØªÙˆØ¶ÛŒØ­Ø§Øª</th>
            </tr>
            <tr>
                <td><code>/data</code></td>
                <td>Ø¯ÛŒØªØ§Ø¨ÛŒØ³ØŒ Ú©Ù„ÛŒØ¯Ù‡Ø§ÛŒ DKIMØŒ ØµÙ Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§</td>
            </tr>
            <tr>
                <td><code>/data/maddy.conf</code></td>
                <td>ÙØ§ÛŒÙ„ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø§ØµÙ„ÛŒ</td>
            </tr>
            <tr>
                <td><code>/data/tls/</code></td>
                <td>Ú¯ÙˆØ§Ù‡ÛŒÙ†Ø§Ù…Ù‡â€ŒÙ‡Ø§ÛŒ TLS (Ø¯Ø± Ø­Ø§Ù„Øª file)</td>
            </tr>
            <tr>
                <td><code>/data/autocert/</code></td>
                <td>Ú©Ø´ Ú¯ÙˆØ§Ù‡ÛŒÙ†Ø§Ù…Ù‡â€ŒÙ‡Ø§ (Ø¯Ø± Ø­Ø§Ù„Øª autocert)</td>
            </tr>
        </table>

        <h2>Ø³Ø§Ø®Øª Ø§Ø² Ø³ÙˆØ±Ø³</h2>
        <div class="code-box"># Ø³Ø§Ø®Øª ØªØµÙˆÛŒØ± Ø¨Ù‡ ØµÙˆØ±Øª Ù…Ø­Ù„ÛŒ
            docker build -t madmail:latest .

            # ÛŒØ§ Ø¨Ø§ docker compose (ØªÙˆØ³Ø¹Ù‡)
            docker compose up -d --build</div>

        <p>ØªØµØ§ÙˆÛŒØ± Ø¯Ø§Ú©Ø± Ø¨Ù‡ ØµÙˆØ±Øª Ø®ÙˆØ¯Ú©Ø§Ø± Ø¯Ø± Ù‡Ø± push Ø¨Ù‡ Ø´Ø§Ø®Ù‡ <code>main</code> Ø³Ø§Ø®ØªÙ‡ Ùˆ Ø¨Ù‡ GHCR Ø§Ø±Ø³Ø§Ù„ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯.</p>

    </div>
</body>

</html>